<?php
//mz: XXX TODO hack to test angular

$this->headTitle('My site')->setSeparator(' / ');

if($this->angular()->isAngularRequest() && $this->exception) {
    echo $this->json(array(
        'title' => 'Exception',
        'exception' => array(
            'message' => $this->exception->getMessage(),
            'code' => $this->exception->getCode(),
            'traceString' => $this->exception->getTraceAsString(),
        ),
        //'content' => $this->content
    ));
    return;
}

//page action
if($this->angular()->isPageRequest()) {
    $headTitle = $this->plugin('HeadTitle')->renderTitle();
    echo $this->json(array(
        'title' => $headTitle,
        'content' => $this->content
    ));
    return;
}

//default angular action
if($this->angular()->isAngularRequest()) {
    echo $this->content;
    return;
}

$this->plugin('InlineScript')->appendFile($this->basePath('/assets/js/jquery.min.js'));
$this->plugin('InlineScript')->appendFile($this->basePath('/assets/js/bootstrap.js'));
$this->plugin('HeadLink')->appendStylesheet($this->basePath('/assets/css/bootstrap.css'));
$this->plugin('HeadLink')->appendStylesheet($this->basePath('/assets/css/bootstrap-responsive.css'));

$this->plugin('InlineScript')->appendFile($this->basePath('/assets/js/angular.js'));
$this->plugin('InlineScript')->appendFile($this->basePath('/assets/js/angular-resource.js'));
//$this->plugin('InlineScript')->appendFile('https://raw.github.com/angular/angular.js/master/src/ngLocale/angular-locale_en-gb.js');
$this->plugin('InlineScript')->appendFile($this->basePath('/assets/js/angular-locale_en-gb.js'));

//$this->plugin('InlineScript')->appendFile('https://raw.github.com/angular-ui/router/ui-states/build/angular-ui-states.js');
$this->plugin('InlineScript')->appendFile($this->basePath('/assets/js/angular-ui-states.js'));

//$this->plugin('InlineScript')->appendFile('http://angular-ui.github.com/bootstrap/ui-bootstrap-tpls-0.1.0.js');
$this->plugin('InlineScript')->appendFile($this->basePath('/assets/js/ui-bootstrap-tpls-0.1.0.js'));

//$this->plugin('InlineScript')->appendFile('https://raw.github.com/angular-ui/ng-grid/master/ng-grid-1.8.0.debug.js');
//$this->plugin('HeadLink')->appendStylesheet('https://raw.github.com/angular-ui/ng-grid/master/ng-grid.css');
//$this->plugin('InlineScript')->appendFile('http://angular-ui.github.com/ng-grid/lib/ng-grid.debug.js');
$this->plugin('InlineScript')->appendFile($this->basePath('/assets/js/ng-grid.debug.js'));
//$this->plugin('HeadLink')->appendStylesheet('http://angular-ui.github.com/ng-grid/css/ng-grid.css');
$this->plugin('HeadLink')->appendStylesheet($this->basePath('/assets/css/ng-grid.css'));

$this->plugin('InlineScript')->appendFile($this->basePath('/assets/js/KapApp.js'));
$this->plugin('HeadLink')->appendStylesheet($this->basePath('/assets/css/kap-angular-theme.css'));

echo $this->plugin('doctype')->setDoctype(\Zend\View\Helper\Doctype::HTML5); ?>
<html lang="en" ng-app="KapApp">
  <head>
    <meta charset="utf-8">
    <title>{{title}}</title>
    <?php
        //echo $this->plugin('HeadTitle');
        echo $this->plugin('HeadMeta');
        echo $this->plugin('HeadLink');
        echo $this->plugin('HeadStyle');
        echo $this->plugin('HeadScript');
    ?>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
  </head>
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="/">Project name</a>
          <div class="nav-collapse collapse">
            <ul class="nav">
              <li ng-class="{ active: $state.includes('home') }"><a href="/">Home</a></li>
              <li ng-class="{ active: $state.includes('identity') }"><a href="/identity/identity/index">Identities</a></li>
              <li ng-class="{ active: $state.includes('contact') }"><a href="/contact/contact/index">Contacts</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
      <br>
      <br>
      <br>
      <?php if(!$this->angular()->isAngularRequest() && $this->exception):?>
      <div><?=$this->content?></div>
      <?php else:?>
      <div ui-view></div>
      <?php endif?>
      
    <?php
        echo $this->plugin('InlineScript');
    ?>
  </body>
</html>
